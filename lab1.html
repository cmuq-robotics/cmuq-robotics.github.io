<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lab 1: Moving the TurtleBot3 &mdash; cmuq-robotics.github.io  documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Lab 0: Installation of the ROS environment for robot control and simulation" href="lab0.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> cmuq-robotics.github.io
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="logistics.html">Logistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="batteries.html">Recharging the Robot Batteries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab0.html">Lab 0: Installation of the ROS environment for robot control and simulation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lab 1: Moving the TurtleBot3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connecting-to-the-ros-network-of-the-robot">Connecting to the ROS network of the robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-the-communication-with-the-ros-network">Testing the communication with the ROS network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#teleoperate-the-robot-using-the-keyboard">Teleoperate the robot using the keyboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-the-trajectories-in-rviz">Visualizing the trajectories in RViz</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cmuq-robotics.github.io</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Lab 1: Moving the TurtleBot3</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lab1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="lab-1-moving-the-turtlebot3">
<h1>Lab 1: Moving the TurtleBot3<a class="headerlink" href="#lab-1-moving-the-turtlebot3" title="Permalink to this headline"></a></h1>
<p>In this course, we will use the <a class="reference external" href="https://emanual.robotis.com/docs/en/platform/turtlebot3/overview/">TurtleBot3</a> platform.
TurtleBot3 is widely used in education, research, hobby, and product prototyping, and it is fully supported by ROS.</p>
<a class="reference internal image-reference" href="_images/turtlebot3.jpg"><img alt="Alternative text" src="_images/turtlebot3.jpg" style="width: 600px;" /></a>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline"></a></h2>
<p>In order to connect your VM to the TurtleBot3, you first need to find out the <em>name</em> of the robot you plan to use.
Currently, we have 3 TurtleBot3 robots in the lab. Their names are:</p>
<ul class="simple">
<li><p>pearl</p></li>
<li><p>allen</p></li>
<li><p>blum</p></li>
</ul>
<p>Once you have chosen a robot, make sure that the battery is charged and connected.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference external" href="batteries.html">battery guidelines</a>.</p>
</div>
<a class="reference internal image-reference" href="_images/tbot3_batt.jpg"><img alt="Alternative text" src="_images/tbot3_batt.jpg" style="width: 600px;" /></a>
<p>The battery should be placed in the bottom level of the robot, and the cables should be pushed inside:</p>
<a class="reference internal image-reference" href="_images/tbot3_battinplace.jpg"><img alt="Alternative text" src="_images/tbot3_battinplace.jpg" style="width: 600px;" /></a>
<p>Your robot is ready to go. You should power on the OpenCR using the front switch:</p>
<a class="reference internal image-reference" href="_images/tbot3_switch.jpg"><img alt="Alternative text" src="_images/tbot3_switch.jpg" style="width: 600px;" /></a>
</div>
<div class="section" id="connecting-to-the-ros-network-of-the-robot">
<h2>Connecting to the ROS network of the robot<a class="headerlink" href="#connecting-to-the-ros-network-of-the-robot" title="Permalink to this headline"></a></h2>
<p>Powering the OpenCR will also power the Raspberry Pi 3B+ in the robot. The
Raspberry Pi runs Ubuntu 18 with ROS Melodic. At boot, a ROS Master will be
started as well as several nodes in charge of the TurtleBot3 core functionality.
You should connect your VM to the ROS network of the robot in order to control
the robot as well as reading sensor data: basically, publishing and subscribing
to topics that are used by the nodes running on the TurtleBot3 Raspberry Pi.</p>
<p>To connect to the ROS network of the robot, you should connect to the WiFi network <cite>cs4qatar</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Check on Piazza the post “How to connect to cs4qatar”.</p>
</div>
<p>Once you are connected to the network you need to take note of your IP address in the WiFi network.
It usually starts with <cite>172.</cite>. You can retrieve this IP using the command <cite>ip a</cite> in the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ip a
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure that your VM is configured in bridged mode and that you are bridging the WiFi interface.
Contact the TA if you cannot see a valid IP address in the VM, and are unsure about how to set the network mode in the VM.</p>
</div>
<p>Finally, we need to set 3 environment variables in each terminal that we want to use to run ROS commands:</p>
<ul class="simple">
<li><p>ROS_MASTER_URI: This is required to tell your ROS nodes where they can locate the master (turtlebot).</p></li>
<li><p>ROS_HOSTNAME: This sets the declared network address of the nodes that you will launch. You should use your IP address in the WiFi network.</p></li>
<li><p>TURTLEBOT3_MODEL:</p></li>
</ul>
<p>You can create a file <cite>connect_robot.sh</cite> in your home directory with the following content:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_MASTER_URI</span><span class="o">=</span><span class="s2">&quot;http://&lt;name of your robot&gt;.qatar.cmu.edu:11311&quot;</span>
<span class="nb">export</span> <span class="nv">ROS_HOSTNAME</span><span class="o">=</span>&lt;your ip address&gt;
<span class="nb">export</span> <span class="nv">TURTLEBOT3_MODEL</span><span class="o">=</span>waffle_pi
</pre></div>
</div>
<p>Then, everytime you open a new terminal window, type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/connect_robot.sh
</pre></div>
</div>
<p>This will set the variables for you.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should set the environment variables in all the terminals. If your IP
address changes, you will need to update the file and re-run the source
command in each terminal window that you want to use.</p>
</div>
</div>
<div class="section" id="testing-the-communication-with-the-ros-network">
<h2>Testing the communication with the ROS network<a class="headerlink" href="#testing-the-communication-with-the-ros-network" title="Permalink to this headline"></a></h2>
<p>Open a new terminal window and set the environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/connect_robot.sh
</pre></div>
</div>
<p>Use the tool <cite>rostopic</cite> to see the list of topics currently used in the network:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rostopic list
</pre></div>
</div>
<p>You should see a list of topics that looks similar to this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">battery_state</span>
<span class="o">/</span><span class="n">cmd_vel</span>
<span class="o">/</span><span class="n">cmd_vel_rc100</span>
<span class="o">/</span><span class="n">diagnostics</span>
<span class="o">/</span><span class="n">firmware_version</span>
<span class="o">/</span><span class="n">imu</span>
<span class="o">/</span><span class="n">joint_states</span>
<span class="o">/</span><span class="n">magnetic_field</span>
<span class="o">/</span><span class="n">motor_power</span>
<span class="o">/</span><span class="n">odom</span>
<span class="o">/</span><span class="n">reset</span>
<span class="o">/</span><span class="n">rosout</span>
<span class="o">/</span><span class="n">rosout_agg</span>
<span class="o">/</span><span class="n">rpms</span>
<span class="o">/</span><span class="n">scan</span>
<span class="o">/</span><span class="n">sensor_state</span>
<span class="o">/</span><span class="n">sound</span>
<span class="o">/</span><span class="n">tf</span>
<span class="o">/</span><span class="n">version_info</span>
</pre></div>
</div>
<p>Now you are ready to move the robot!</p>
</div>
<div class="section" id="teleoperate-the-robot-using-the-keyboard">
<h2>Teleoperate the robot using the keyboard<a class="headerlink" href="#teleoperate-the-robot-using-the-keyboard" title="Permalink to this headline"></a></h2>
<p>To test that everything is fine, we can do a quick test using the <cite>turtlebot3_teleop</cite> package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
</pre></div>
</div>
<p>If the node is successfully launched, the following instruction will be appeared to the terminal window.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Control Your Turtlebot3!
---------------------------
Moving around:
        w
   a    s    d
        x

w/x : increase/decrease linear velocity
a/d : increase/decrease angular velocity
space key, s : force stop

CTRL-C to quit
</pre></div>
</div>
</div>
<div class="section" id="visualizing-the-trajectories-in-rviz">
<h2>Visualizing the trajectories in RViz<a class="headerlink" href="#visualizing-the-trajectories-in-rviz" title="Permalink to this headline"></a></h2>
<p>While moving the robot, you can use <strong>RViz</strong> to visualize the robot trajectory. In a new terminal, set the environment variables and launch rviz with a predefined configuration for the turtlebot3. But first, we need to run <cite>turtlebot3_remote.launch</cite> to load the 3D model of the robot (otherwise, it won’t show in RViz).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/connect_robot.sh
roslaunch turtlebot3_bringup turtlebot3_remote.launch
</pre></div>
</div>
<p>Open a new terminal and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/connect_robot.sh
rosrun rviz rviz -d <span class="sb">`</span>rospack find turtlebot3_description<span class="sb">`</span>/rviz/model.rviz
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The previous command runs rviz using a predefined configuration. What’s the purpose of <cite>rospack find turtlebot3_description</cite> here?</p>
</div>
<p>You should now have an RViz window open showing the TurtleBot3 (the real one!).</p>
<a class="reference internal image-reference" href="_images/tbot3_rviz.png"><img alt="Alternative text" src="_images/tbot3_rviz.png" style="width: 600px;" /></a>
<p>Change the <cite>Fixed Frame</cite> to <cite>odom</cite> in the <cite>Global Options</cite>.</p>
<a class="reference internal image-reference" href="_images/tbot_rviz_frameodom.png"><img alt="Alternative text" src="_images/tbot_rviz_frameodom.png" style="width: 600px;" /></a>
<p>Create a visualization for the <cite>/odom</cite> topic by clicking <cite>Add</cite> in the <cite>Displays pane</cite></p>
<a class="reference internal image-reference" href="_images/tbot_rviz_addodom.png"><img alt="Alternative text" src="_images/tbot_rviz_addodom.png" style="width: 600px;" /></a>
<p>Tune the visualization parameters to make it nicer. We use:</p>
<ul class="simple">
<li><p>Shaft Length: 0.1</p></li>
<li><p>Shaft Radius: 0.005</p></li>
<li><p>Head Length: 0.05</p></li>
<li><p>Head Radius: 0.02</p></li>
</ul>
<a class="reference internal image-reference" href="_images/tbot_rviz_showodom.png"><img alt="Alternative text" src="_images/tbot_rviz_showodom.png" style="width: 600px;" /></a>
<p>Now you can move the robot and visualize its trajectory. You are ready to do the Lab!</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lab0.html" class="btn btn-neutral float-left" title="Lab 0: Installation of the ROS environment for robot control and simulation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, efeoflus.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>